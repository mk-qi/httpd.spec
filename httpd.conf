ServerRoot "/usr/local/apache2"

Listen 80
#LoadModule php5_module        modules/libphp5.so
LoadModule env_module modules/mod_env.so
LoadModule setenvif_module modules/mod_setenvif.so
#LoadModule auth_basic_module modules/mod_auth_basic.so
#LoadModule authn_file_module modules/mod_authn_file.so
#LoadModule security2_module modules/mod_security2.so

<IfModule !mpm_netware_module>
<IfModule !mpm_winnt_module>
#SecChrootDir /data/chroot/
User daemon
Group daemon
</IfModule>
</IfModule>

ServerAdmin changjun.qi@51fanli.com
ServerName it.51fanli.it:80

DocumentRoot "/usr/local/apache2/htdocs"
<Directory />
    Options FollowSymLinks
    AllowOverride None
    Order deny,allow
    Deny from all
</Directory>
<Directory "/usr/local/apache2/htdocs">
    Options Indexes FollowSymLinks
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>
<IfModule dir_module>
    DirectoryIndex index.html index.htm index.php
</IfModule>
<FilesMatch "^\.ht">
    Order allow,deny
    Deny from all
    Satisfy All
</FilesMatch>
ErrorLog "logs/error_log"
LogLevel warn

<IfModule log_config_module>
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%{X-Forwarded-For}i %{__utmo}C %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %D %{prouserid}C %V %A %h %{__utmp}C - -" combined_51fanli
    LogFormat "%h %l %u %t \"%r\" %>s %b" common

    <IfModule logio_module>
      LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
    </IfModule>

    CustomLog "logs/access_log" combined_51fanli
</IfModule>

<IfModule alias_module>
    ScriptAlias /cgi-bin/ "/usr/local/apache2/cgi-bin/"
</IfModule>

<IfModule cgid_module>
    #Scriptsock logs/cgisock
</IfModule>

<Directory "/usr/local/apache2/cgi-bin">
    AllowOverride None
    Options None
    Order allow,deny
    Allow from all
</Directory>

DefaultType text/plain
<IfModule mime_module>
    TypesConfig conf/mime.types
    AddType application/x-compress .Z
    AddType application/x-gzip .gz .tgz
    AddType application/x-httpd-php .php
    AddType application/x-httpd-php-source .phps
</IfModule>

<IfModule !mpm_netware_module>
    PidFile "logs/httpd.pid"
</IfModule>

 #
 # The accept serialization lock file MUST BE STORED ON A LOCAL DISK.
 #
<IfModule !mpm_winnt_module>
<IfModule !mpm_netware_module>
LockFile "logs/accept.lock"
</IfModule>
</IfModule>



 # prefork MPM
 # StartServers: number of server processes to start
 # MinSpareServers: minimum number of server processes which are kept spare
 # MaxSpareServers: maximum number of server processes which are kept spare
 # MaxClients: maximum number of server processes allowed to start
 # MaxRequestsPerChild: maximum number of requests a server process serves
<IfModule mpm_prefork_module>
    ServerLimit 2000
    StartServers          100
    MinSpareServers       5
    MaxSpareServers      10
    MaxClients          1000
    MaxRequestsPerChild   10000
</IfModule>

 # end MPM
 # for the server-status handler

<Location /server-status>
    SetHandler server-status
    Order deny,allow
    Deny from all
    Allow from 192.168.2.250  192.168.2.90 127.0.0.1 172.12
</Location>

ExtendedStatus On
 #end server-status handle
 # Apache Default.conf
Timeout 300
KeepAlive On
MaxKeepAliveRequests 1000
KeepAliveTimeout 5
UseCanonicalName Off
AccessFileName .htaccess
ServerTokens Prod
ServerSignature Off
HostnameLookups Off
 # end default

 #
 # Virtual Hosts
 #
NameVirtualHost *:80
<VirtualHost *:80>
    ServerAdmin webmaster@51fanli.com
    DocumentRoot "/usr/local/webdata/root"
    ServerName localhost
    ErrorLog "logs/error_log"
    CustomLog "logs/access_log" combined_51fanli

    <Directory "/usr/local/webdata/root">
        Options FollowSymLinks
        AllowOverride All
        Order allow,deny
        Allow from all
    </Directory>

   <Location /test/apc.php>
    	Order Allow,Deny
    	Deny from  192.168.2.171 192.168.2.172 192.168.2.40 192.168.2.150
    	Allow from 192.168.0.0/16 172.12
   </Location>

</VirtualHost>

Include conf/vhosts/*.conf
 # end virtual host
<IfModule ssl_module>
SSLRandomSeed startup builtin
SSLRandomSeed connect builtin
</IfModule>

<Location />
 # Make sure proxies don't deliver the wrong content
 AddOutputFilterByType DEFLATE text/html text/plain text/css application/javascript application/x-javascript application/xml
 Header append Vary Accept-Encoding env=!dont-vary
 # enable expirations
 ExpiresActive On
 ExpiresDefault "access plus 1 days"
 ExpiresByType text/html "access"
 ExpiresByType application/javascript "access plus 1 months"
 ExpiresByType text/css "access plus 1 months"
 ExpiresByType text/plain "access plus 1 months"
 ExpiresByType image/gif "access plus 1 months"
 ExpiresByType image/png "access plus 1 months"
 ExpiresByType image/jpeg "access plus 1 months"
 ExpiresByType image/x-icon "access plus 1 years"

 #Turn etag off 
 FileETag none
</Location>

SetEnvIf Range (,.*?){5,} bad-range=1
RequestHeader unset Range env=bad-range

 #reset some headers
PassEnv HOSTNAME
Header set X-Served-By "%{HOSTNAME}e"
Header unset X-Powered-By
Header set Server  "tomcat"

 #turn off tace method
TraceEnable off
